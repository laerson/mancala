#cloud-config
hostname: ${hostname}
fqdn: ${hostname}.local

package_update: true
package_upgrade: true

packages:
  - curl
  - wget
  - apt-transport-https
  - ca-certificates
  - gnupg
  - lsb-release
  - software-properties-common
  - python3-pip
  - git

runcmd:
  - hostnamectl set-hostname ${hostname}
  - echo "127.0.0.1 ${hostname}" >> /etc/hosts
  - systemctl enable systemd-resolved
  - systemctl start systemd-resolved

write_files:
  - path: /etc/modules-load.d/k8s.conf
    content: |
      overlay
      br_netfilter
  - path: /etc/sysctl.d/k8s.conf
    content: |
      net.bridge.bridge-nf-call-iptables  = 1
      net.bridge.bridge-nf-call-ip6tables = 1
      net.ipv4.ip_forward                 = 1

final_message: "Cloud-init setup completed"